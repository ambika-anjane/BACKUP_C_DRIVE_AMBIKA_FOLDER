
/***********************************************************************************************************************************************************/

create table BI11G_DW.C$_4980245864_1_0
(
	C1_DEMAND_TYPE	VARCHAR2(4000) NULL,
	C2_DEMAND_CLASS	VARCHAR2(4000) NULL,
	C3_DEMAND_QTY	NUMBER NULL,
	C4_W_UPDATE_DT	DATE NULL,
	C5_DUE_DATE	DATE NULL,
	C6_SALES_ORDER_NUMBER	VARCHAR2(4000) NULL,
	C7_PLAN_NAME	VARCHAR2(4000) NULL,
	C8_DEMAND_FLAG	VARCHAR2(4000) NULL,
	C9_WEEKLY_FLAG	VARCHAR2(4000) NULL,
	C10_DAILY_CUTOFF_BUCKET	NUMBER NULL,
	C11_CUSTOMER_ID	NUMBER NULL,
	C12_ORGANIZATION_ID	NUMBER NULL,
	C13_INVENTORY_ITEM_ID	NUMBER NULL
)
NOLOGGING

/***********************************************************************************************************************************************************/

 (SELECT MSC_SYSTEM_ITEMS.SR_INVENTORY_ITEM_ID INVENTORY_ITEM_ID,
      MSC_DEMANDS.CUSTOMER_ID CUSTOMER_ID,
      TRUNC(MSC_DEMANDS.USING_ASSEMBLY_DEMAND_DATE) DUE_DATE,
      NVL(MSC_DEMANDS.DEMAND_CLASS,'NA') DEMAND_CLASS,
      SUM(NVL(MSC_DEMANDS.DAILY_DEMAND_RATE,MSC_DEMANDS.USING_REQUIREMENT_QUANTITY)) QUANTITY,
      TRUNC(MSC_DEMANDS.LAST_UPDATE_DATE) W_UPDATE_DT,
      MSC_DEMANDS.ORGANIZATION_ID ORGANIZATION_ID,
      MFG_LOOKUPS.MEANING ORDER_TYPE,
      TO_CHAR(SUBSTR(MSC_DEMANDS.ORDER_NUMBER,1,instr(MSC_DEMANDS.ORDER_NUMBER,'.',1)-1)) SALES_ORDER_NUMBER,
      MSC_PLANS.COMPILE_DESIGNATOR COMPILE_DESIGNATOR,
      CASE
        WHEN ((NVL(case when msc_demands.organization_id = 1200 and msc_demands.source_organization_id = 1202 then null else msc_demands.source_organization_id end,0) > 0
        AND MSC_DEMANDS.source_organization_id           <> MSC_DEMANDS.organization_id)
        OR msc_demands.inventory_item_id                 <> msc_demands.using_assembly_item_id)
        THEN 'N'
        ELSE 'Y'
      END demand_flag , -- added to exlcude component item demand used for make items, and do not apply org dependent logic for dop items in dtx
      CASE
        WHEN MFG_LOOKUPS.MEANING         ='Forecast'
        AND MSC_DEMANDS.ORGANIZATION_ID IN
          (SELECT sr_organization_id
          FROM apps.msd_dp_scn_entries_denorm
          WHERE start_time >=(sysdate-365)
          AND BUCKET_TYPE   =2
          )
        THEN 'Y'
        ELSE 'N'
      END WEEKLY_FLAG ,
      MSC_PLANS.DAILY_CUTOFF_BUCKET
    FROM APPS.MSC_DEMANDS MSC_DEMANDS,
      APPS.MSC_PLANS MSC_PLANS,
      APPS.MSC_SYSTEM_ITEMS MSC_SYSTEM_ITEMS,
      APPS.MFG_LOOKUPS MFG_LOOKUPS,
      APPS.MSC_PLAN_ORGANIZATIONS mpo
    WHERE(1                                     =1)
    AND mpo.plan_id                             = msc_demands.plan_id
    AND mpo.organization_id                     = msc_demands.organization_id
    AND mpo.sr_instance_id                      = msc_demands.sr_instance_id
    AND (MFG_LOOKUPS.LOOKUP_TYPE                ='MSC_DEMAND_ORIGINATION')
    AND (MSC_DEMANDS.USING_REQUIREMENT_QUANTITY >0)
    AND (MFG_LOOKUPS.MEANING                   IN('Forecast','Payback Demand','Planned order demand','Interorganization Demand','Sales Orders','Work order demand','Safety Stock Demand'))
    AND (MSC_PLANS.PLAN_ID                      =MSC_DEMANDS.PLAN_ID)
    AND (MSC_PLANS.COMPILE_DESIGNATOR          IN
      (SELECT DESIGNATOR FROM APPS.MSC_DESIGNATORS WHERE DISABLE_DATE IS NULL
      ))
    AND (MSC_SYSTEM_ITEMS.PLAN_ID       =MSC_PLANS.PLAN_ID)
    AND (MSC_SYSTEM_ITEMS.SR_INSTANCE_ID=MSC_DEMANDS.SR_INSTANCE_ID
    AND MSC_DEMANDS.INVENTORY_ITEM_ID   =MSC_SYSTEM_ITEMS.INVENTORY_ITEM_ID
    AND MSC_SYSTEM_ITEMS.ORGANIZATION_ID=MSC_DEMANDS.ORGANIZATION_ID
    AND MSC_SYSTEM_ITEMS.PLAN_ID        =MSC_DEMANDS.PLAN_ID)
    AND (MSC_DEMANDS.ORIGINATION_TYPE   =MFG_LOOKUPS.LOOKUP_CODE)
    GROUP BY MSC_SYSTEM_ITEMS.SR_INVENTORY_ITEM_ID,
      MSC_DEMANDS.CUSTOMER_ID,
      TRUNC(MSC_DEMANDS.USING_ASSEMBLY_DEMAND_DATE),
      NVL(MSC_DEMANDS.DEMAND_CLASS,'NA'),
      TRUNC(MSC_DEMANDS.LAST_UPDATE_DATE),
      MSC_DEMANDS.ORGANIZATION_ID,
      MFG_LOOKUPS.MEANING,
      SUBSTR(MSC_DEMANDS.ORDER_NUMBER,1,instr(MSC_DEMANDS.ORDER_NUMBER,'.',1)-1),
      MSC_PLANS.COMPILE_DESIGNATOR,
      CASE
        WHEN ((NVL(case when msc_demands.organization_id = 1200 and msc_demands.source_organization_id = 1202 then null else msc_demands.source_organization_id end,0) > 0
        AND MSC_DEMANDS.source_organization_id           <> MSC_DEMANDS.organization_id)
        OR msc_demands.inventory_item_id                 <> msc_demands.using_assembly_item_id)
        THEN 'N'
        ELSE 'Y'
      END,
      MSC_PLANS.DAILY_CUTOFF_BUCKET
    )
  UNION ALL
    (SELECT MSC_SYSTEM_ITEMS.SR_INVENTORY_ITEM_ID C11_INVENTORY_ITEM_ID,
      MSC_FORECAST_UPDATES.CUSTOMER_ID C12_CUSTOMER_ID,
      TRUNC(MSC_FORECAST_UPDATES.CONSUMPTION_DATE) C13_DUE_DATE,
      NVL(MSC_FORECAST_UPDATES.DEMAND_CLASS,'NA') C14_DEMAND_CLASS,
      SUM(MSC_FORECAST_UPDATES.CONSUMED_QTY) C15_QUANTITY,
      TRUNC(MSC_FORECAST_UPDATES.LAST_UPDATE_DATE) C16_W_UPDATE_DT,
      MSC_FORECAST_UPDATES.ORGANIZATION_ID C17_ORGANIZATION_ID,
      'Consumption' C8_ORDER_TYPE,
      TO_CHAR(SUBSTR(MSC_FORECAST_UPDATES.SALES_ORDER_NUMBER,1,instr(MSC_FORECAST_UPDATES.SALES_ORDER_NUMBER,'.',1)-1)) C18_SALES_ORDER_NUMBER,
      MSC_PLANS.COMPILE_DESIGNATOR C19_COMPILE_DESIGNATOR,
      'Y' AS demand_flag,
      'N' AS weekly_flag,
      MSC_PLANS.DAILY_CUTOFF_BUCKET
    FROM APPS.MSC_PLANS MSC_PLANS,
      APPS.MSC_SYSTEM_ITEMS MSC_SYSTEM_ITEMS,
      APPS.MSC_FORECAST_UPDATES MSC_FORECAST_UPDATES,
      APPS.MSC_PLAN_ORGANIZATIONS mpo
    WHERE(1                               =1)
    AND mpo.plan_id                       = msc_forecast_updates.plan_id
    AND mpo.organization_id               = msc_forecast_updates.organization_id
    AND mpo.sr_instance_id                = msc_forecast_updates.sr_instance_id
    AND (MSC_FORECAST_UPDATES.CONSUMED_QTY>0)
    AND (MSC_PLANS.PLAN_ID                =MSC_SYSTEM_ITEMS.PLAN_ID)
    AND (MSC_PLANS.COMPILE_DESIGNATOR    IN
      (SELECT DESIGNATOR FROM APPS.MSC_DESIGNATORS WHERE DISABLE_DATE IS NULL
      ))
    AND (MSC_SYSTEM_ITEMS.INVENTORY_ITEM_ID=MSC_FORECAST_UPDATES.INVENTORY_ITEM_ID
    AND MSC_SYSTEM_ITEMS.ORGANIZATION_ID   =MSC_FORECAST_UPDATES.ORGANIZATION_ID)
    AND (MSC_PLANS.PLAN_ID                 =MSC_FORECAST_UPDATES.PLAN_ID)
    GROUP BY MSC_SYSTEM_ITEMS.SR_INVENTORY_ITEM_ID,
      MSC_FORECAST_UPDATES.CUSTOMER_ID,
      TRUNC(MSC_FORECAST_UPDATES.CONSUMPTION_DATE),
      NVL(MSC_FORECAST_UPDATES.DEMAND_CLASS,'NA'),
      TRUNC(MSC_FORECAST_UPDATES.LAST_UPDATE_DATE),
      MSC_FORECAST_UPDATES.ORGANIZATION_ID,
      SUBSTR(MSC_FORECAST_UPDATES.SALES_ORDER_NUMBER,1,instr(MSC_FORECAST_UPDATES.SALES_ORDER_NUMBER,'.',1)-1),
      MSC_PLANS.COMPILE_DESIGNATOR,
      MSC_PLANS.DAILY_CUTOFF_BUCKET
    )
  UNION ALL
    (SELECT MTL_SYSTEM_ITEMS.INVENTORY_ITEM_ID C20_INVENTORY_ITEM_ID,
      OE_ORDER_LINES_ALL.SOLD_TO_ORG_ID C21_CUSTOMER_ID,
      TRUNC(OE_ORDER_LINES_ALL.REQUEST_DATE) C22_DUE_DATE,
      NVL(OE_ORDER_LINES_ALL.DEMAND_CLASS_CODE,'NA') C23_DEMAND_CLASS,
      SUM(OE_ORDER_LINES_ALL.ORDERED_QUANTITY*NVL(MTL_UOM_CONVERSIONS.CONVERSION_RATE,1)) C24_QUANTITY,
      TRUNC(OE_ORDER_LINES_ALL.LAST_UPDATE_DATE) C25_W_UPDATE_DT,
      MTL_SYSTEM_ITEMS.ORGANIZATION_ID C26_ORGANIZATION_ID,
      'Unschedule' C8_ORDER_TYPE,
      TO_CHAR(OE_ORDER_HEADERS_ALL.ORDER_NUMBER) C27_SALES_ORDER_NUMBER,
      'NA' C19_COMPILE_DESIGNATOR,
      'Y'AS demand_flag,
      'N'AS weekly_flag,
      0
    FROM APPS.MTL_UOM_CONVERSIONS MTL_UOM_CONVERSIONS
    RIGHT OUTER JOIN(((APPS.OE_ORDER_LINES_ALL OE_ORDER_LINES_ALL
    INNER JOIN APPS.MTL_SYSTEM_ITEMS MTL_SYSTEM_ITEMS
    ON OE_ORDER_LINES_ALL.INVENTORY_ITEM_ID=MTL_SYSTEM_ITEMS.INVENTORY_ITEM_ID
    AND OE_ORDER_LINES_ALL.SHIP_FROM_ORG_ID=MTL_SYSTEM_ITEMS.ORGANIZATION_ID)
    INNER JOIN APPS.OE_ORDER_HEADERS_ALL OE_ORDER_HEADERS_ALL
    ON OE_ORDER_LINES_ALL.HEADER_ID=OE_ORDER_HEADERS_ALL.HEADER_ID)
    INNER JOIN APPS.MTL_PARAMETERS MTL_PARAMETERS
    ON OE_ORDER_LINES_ALL.SHIP_FROM_ORG_ID    =MTL_PARAMETERS.ORGANIZATION_ID)
    ON MTL_UOM_CONVERSIONS.INVENTORY_ITEM_ID  =OE_ORDER_LINES_ALL.INVENTORY_ITEM_ID
    AND MTL_UOM_CONVERSIONS.UOM_CODE          =OE_ORDER_LINES_ALL.ORDER_QUANTITY_UOM
    WHERE(1                                   =1)
    AND (OE_ORDER_LINES_ALL.FLOW_STATUS_CODE IN('BOOKED','ENTERED')
    AND OE_ORDER_LINES_ALL.OPEN_FLAG          ='Y'
    AND OE_ORDER_LINES_ALL.LINE_CATEGORY_CODE ='ORDER')
    GROUP BY MTL_SYSTEM_ITEMS.INVENTORY_ITEM_ID,
      OE_ORDER_LINES_ALL.SOLD_TO_ORG_ID,
      TRUNC(OE_ORDER_LINES_ALL.REQUEST_DATE),
      NVL(OE_ORDER_LINES_ALL.DEMAND_CLASS_CODE,'NA'),
      TRUNC(OE_ORDER_LINES_ALL.LAST_UPDATE_DATE),
      MTL_SYSTEM_ITEMS.ORGANIZATION_ID,
      TO_CHAR(OE_ORDER_HEADERS_ALL.ORDER_NUMBER)
    )
  UNION ALL
    (SELECT MSC_SYSTEM_ITEMS.SR_INVENTORY_ITEM_ID C28_INVENTORY_ITEM_ID,
      MSC_SALES_ORDERS.CUSTOMER_ID C29_CUSTOMER_ID,
      --     TRUNC(MSC_SALES_ORDERS.REQUIREMENT_DATE)         C30_DUE_DATE,
      TRUNC(OLA.ACTUAL_SHIPMENT_DATE) C30_DUE_DATE,
      NVL(MSC_SALES_ORDERS.DEMAND_CLASS,'NA') C31_DEMAND_CLASS,
      SUM(MSC_SALES_ORDERS.COMPLETED_QUANTITY) C32_QUANTITY,
      TRUNC(MSC_SALES_ORDERS.LAST_UPDATE_DATE) C33_W_UPDATE_DT,
      MSC_SALES_ORDERS.ORGANIZATION_ID C34_ORGANIZATION_ID,
      'Shipped' C8_ORDER_TYPE,
      TO_CHAR(SUBSTR(MSC_SALES_ORDERS.SALES_ORDER_NUMBER,1,instr(MSC_SALES_ORDERS.SALES_ORDER_NUMBER,'.',1)-1)) C35_SALES_ORDER_NUMBER,
      MSC_PLANS.COMPILE_DESIGNATOR C19_COMPILE_DESIGNATOR,
      'Y' AS demand_flag,
      'N' AS weekly_flag,
      MSC_PLANS.DAILY_CUTOFF_BUCKET
    FROM APPS.MSC_SYSTEM_ITEMS MSC_SYSTEM_ITEMS,
      APPS.MSC_SALES_ORDERS MSC_SALES_ORDERS,
      APPS.MSC_PLANS MSC_PLANS,
      APPS.OE_ORDER_LINES_ALL OLA
    WHERE(1                          =1)
    AND (MSC_SALES_ORDERS.DEMAND_ID IN
      (SELECT DISTINCT SALES_ORDER_ID
      FROM APPS.MSC_FORECAST_UPDATES M,
        APPS.MSC_SYSTEM_ITEMS I
      WHERE M.INVENTORY_ITEM_ID=I.INVENTORY_ITEM_ID
      AND M.ORGANIZATION_ID    = I.ORGANIZATION_ID
      AND M.PLAN_ID            = I.PLAN_ID
      ))
    AND MSC_SALES_ORDERS.DEMAND_SOURCE_LINE = OLA.LINE_ID
    AND (MSC_SALES_ORDERS.COMPLETED_QUANTITY>0)
    AND (MSC_SYSTEM_ITEMS.INVENTORY_ITEM_ID =MSC_SALES_ORDERS.INVENTORY_ITEM_ID
    AND MSC_SYSTEM_ITEMS.ORGANIZATION_ID    =MSC_SALES_ORDERS.ORGANIZATION_ID)
    AND (MSC_PLANS.PLAN_ID                  =MSC_SYSTEM_ITEMS.PLAN_ID
    AND MSC_SYSTEM_ITEMS.PLAN_ID           <>-1)
    AND (MSC_PLANS.COMPILE_DESIGNATOR       IN
      (SELECT DESIGNATOR FROM APPS.MSC_DESIGNATORS WHERE DISABLE_DATE IS NULL
      ))
    GROUP BY MSC_SYSTEM_ITEMS.SR_INVENTORY_ITEM_ID,
      MSC_SALES_ORDERS.CUSTOMER_ID,
      TRUNC(OLA.ACTUAL_SHIPMENT_DATE),
      --TRUNC(MSC_SALES_ORDERS.REQUIREMENT_DATE),
      NVL(MSC_SALES_ORDERS.DEMAND_CLASS,'NA'),
      TRUNC(MSC_SALES_ORDERS.LAST_UPDATE_DATE),
      MSC_SALES_ORDERS.ORGANIZATION_ID,
      SUBSTR(MSC_SALES_ORDERS.SALES_ORDER_NUMBER,1,instr(MSC_SALES_ORDERS.SALES_ORDER_NUMBER,'.',1)-1),
      MSC_PLANS.COMPILE_DESIGNATOR,
      MSC_PLANS.DAILY_CUTOFF_BUCKET
    )
  UNION ALL
    (SELECT MSI.sr_INVENTORY_ITEM_ID INVENTORY_ITEM_ID,
      NULL CUSTOMER_ID,
      MSS.PERIOD_START_DATE DUE_DATE,
      'NA' DEMAND_CLASS,
      MSS.SAFETY_STOCK_QUANTITY QUANTITY,
      SYSDATE W_UPDATE_DT,
      MSS.ORGANIZATION_ID,
      'Safety Stock' ORDER_TYPE,
      NULL SALES_ORDER_NUMBER,
      MSC.COMPILE_DESIGNATOR COMPILE_DESIGNATOR,
      'N' DEMAND_FLAG,
      'N' WEEKLY_FLAG,
      MSC.DAILY_CUTOFF_BUCKET
    FROM apps.MSC_SAFETY_STOCKS MSS,
      apps.MSC_SYSTEM_ITEMS MSI,
      APPS.MSC_PLANS MSC
    WHERE MSS.SR_INSTANCE_ID    = MSI.SR_INSTANCE_ID
    AND MSS.INVENTORY_ITEM_ID   = MSI.INVENTORY_ITEM_ID
    AND MSS.ORGANIZATION_ID     = MSI.ORGANIZATION_ID
    AND MSS.PLAN_ID             = MSI.PLAN_ID
    AND MSI.PLAN_ID             =MSC.PLAN_ID
    AND(MSC.COMPILE_DESIGNATOR IN
      (SELECT DESIGNATOR FROM APPS.MSC_DESIGNATORS WHERE DISABLE_DATE IS NULL
      ))
    )
  UNION ALL
    (SELECT OLA.INVENTORY_ITEM_ID C28_INVENTORY_ITEM_ID,
      OLA.SOLD_TO_ORG_ID C29_CUSTOMER_ID,
      TRUNC(NVL(OLA.LATEST_ACCEPTABLE_DATE,OLA.SCHEDULE_SHIP_DATE)) C30_DUE_DATE,
      NVL(OLA.DEMAND_CLASS_CODE,'NA') C31_DEMAND_CLASS,
      SUM(OLA.ORDERED_QUANTITY*NVL(MUC.CONVERSION_RATE,1)) C32_QUANTITY, --UOM Conversion required
      TRUNC(OLA.LAST_UPDATE_DATE) C33_W_UPDATE_DT,
      OLA.SHIP_FROM_ORG_ID C34_ORGANIZATION_ID,
      'Sales Orders - LAD' C8_ORDER_TYPE,
      TO_CHAR(OHA.ORDER_NUMBER) C35_SALES_ORDER_NUMBER,
      'GLOBAL' C19_COMPILE_DESIGNATOR,
      'Y' AS demand_flag,
      'N' AS weekly_flag,
      0 DAILY_CUTOFF_BUCKET
    FROM APPS.OE_ORDER_LINES_ALL OLA,
      APPS.OE_ORDER_HEADERS_ALL OHA,
      APPS.MTL_UOM_CONVERSIONS MUC
    WHERE(1                     =1)
    AND OLA.HEADER_ID           = OHA.HEADER_ID
    AND OLA.OPEN_FLAG           = 'Y'
    AND OHA.OPEN_FLAG           = 'Y'
    AND OLA.ORDER_SOURCE_ID    <>10
    AND OLA.LINE_CATEGORY_CODE  ='ORDER'
    AND MUC.INVENTORY_ITEM_ID(+)=OLA.INVENTORY_ITEM_ID
    AND MUC.UOM_CODE(+)         =OLA.ORDER_QUANTITY_UOM
    GROUP BY OLA.INVENTORY_ITEM_ID,
      OLA.SOLD_TO_ORG_ID,
      TRUNC(NVL(OLA.LATEST_ACCEPTABLE_DATE,OLA.SCHEDULE_SHIP_DATE)),
      NVL(OLA.DEMAND_CLASS_CODE,'NA'),
      TRUNC(OLA.LAST_UPDATE_DATE),
      OLA.SHIP_FROM_ORG_ID,
      OHA.ORDER_NUMBER
    )

/***********************************************************************************************************************************************************/

insert #BIAPPS.ETL_HINT_INSERT_VALUES into BI11G_DW.C$_4980245864_1_0
(
	C1_DEMAND_TYPE,
	C2_DEMAND_CLASS,
	C3_DEMAND_QTY,
	C4_W_UPDATE_DT,
	C5_DUE_DATE,
	C6_SALES_ORDER_NUMBER,
	C7_PLAN_NAME,
	C8_DEMAND_FLAG,
	C9_WEEKLY_FLAG,
	C10_DAILY_CUTOFF_BUCKET,
	C11_CUSTOMER_ID,
	C12_ORGANIZATION_ID,
	C13_INVENTORY_ITEM_ID
)
values
(
	:C1_DEMAND_TYPE,
	:C2_DEMAND_CLASS,
	:C3_DEMAND_QTY,
	:C4_W_UPDATE_DT,
	:C5_DUE_DATE,
	:C6_SALES_ORDER_NUMBER,
	:C7_PLAN_NAME,
	:C8_DEMAND_FLAG,
	:C9_WEEKLY_FLAG,
	:C10_DAILY_CUTOFF_BUCKET,
	:C11_CUSTOMER_ID,
	:C12_ORGANIZATION_ID,
	:C13_INVENTORY_ITEM_ID
)

/***********************************************************************************************************************************************************/

insert into	BI11G_DW.WC_SALES_DEMAND_F 
( 
	INVENTORY_PRODUCT_WID,
	INVENTORY_ORG_WID,
	CUSTOMER_WID,
	DUE_DATE_WID,
	DEMAND_TYPE,
	DEMAND_CLASS,
	DEMAND_QTY,
	W_UPDATE_DT,
	INTEGRATION_ID,
	PLANT_LOCATION_WID,
	DUE_DATE,
	SALES_ORDER_NUMBER,
	PLAN_NAME,
	ITEM_AVG_COST,
	USD_CONV_RATE,
	INV_ORG_CURR_CODE,
	PRODUCT_WID,
	GL_COMPANY_WID,
	GL_LOCATION_WID,
	GL_PRODUCT_LINE_WID,
	DEMAND_FLAG,
	WEEKLY_FLAG,
	DAILY_CUTOFF_BUCKET 
	,DATASOURCE_NUM_ID 
) 

select
    INVENTORY_PRODUCT_WID,
	INVENTORY_ORG_WID,
	CUSTOMER_WID,
	DUE_DATE_WID,
	DEMAND_TYPE,
	DEMAND_CLASS,
	DEMAND_QTY,
	W_UPDATE_DT,
	INTEGRATION_ID,
	PLANT_LOCATION_WID,
	DUE_DATE,
	SALES_ORDER_NUMBER,
	PLAN_NAME,
	ITEM_AVG_COST,
	USD_CONV_RATE,
	INV_ORG_CURR_CODE,
	PRODUCT_WID,
	GL_COMPANY_WID,
	GL_LOCATION_WID,
	GL_PRODUCT_LINE_WID,
	DEMAND_FLAG,
	WEEKLY_FLAG,
	DAILY_CUTOFF_BUCKET   
  ,#BIAPPS.DATASOURCE_NUM_ID 
FROM (	


select 	
	CASE WHEN W_INVENTORY_PRODUCT_D.ROW_WID IS NULL THEN 0 ELSE W_INVENTORY_PRODUCT_D.ROW_WID END INVENTORY_PRODUCT_WID,
	CASE WHEN W_INT_ORG_D.ROW_WID IS NULL THEN 0 ELSE W_INT_ORG_D.ROW_WID END INVENTORY_ORG_WID,
	CASE WHEN W_CUSTOMER_ACCOUNT_D.ROW_WID IS NULL THEN 0 ELSE W_CUSTOMER_ACCOUNT_D.ROW_WID END CUSTOMER_WID,
	W_MCAL_DAY_D.ROW_WID DUE_DATE_WID,
	C1_DEMAND_TYPE DEMAND_TYPE,
	C2_DEMAND_CLASS DEMAND_CLASS,
	C3_DEMAND_QTY DEMAND_QTY,
	C4_W_UPDATE_DT W_UPDATE_DT,
	TO_CHAR(C11_CUSTOMER_ID)||'~'||TO_CHAR(C12_ORGANIZATION_ID)||'~'||TO_CHAR(C13_INVENTORY_ITEM_ID)||'~'||TO_CHAR(C1_DEMAND_TYPE)||'~'||TO_CHAR(W_MCAL_DAY_D.ROW_WID)||'~'||TO_CHAR(C7_PLAN_NAME) INTEGRATION_ID,
	CASE WHEN W_BUSN_LOCATION_D.ROW_WID IS NULL THEN 0 ELSE W_BUSN_LOCATION_D.ROW_WID END PLANT_LOCATION_WID,
	C5_DUE_DATE DUE_DATE,
	C6_SALES_ORDER_NUMBER SALES_ORDER_NUMBER,
	C7_PLAN_NAME PLAN_NAME,
	NVL(WC_MTL_SYSTEM_ITEMS_D.MATERIAL_COST,0)+ NVL(WC_MTL_SYSTEM_ITEMS_D.MATERIAL_OVERHEAD_COST,0)+ NVL(WC_MTL_SYSTEM_ITEMS_D.RESOURCE_COST,0)+NVL(WC_MTL_SYSTEM_ITEMS_D.OSP_COST,0) ITEM_AVG_COST,
	CASE WHEN W_INT_ORG_D.W_CURR_CODE='USD' THEN 1 ELSE W_EXCH_RATE_G.EXCH_RATE END USD_CONV_RATE,
	W_INT_ORG_D.W_CURR_CODE INV_ORG_CURR_CODE,
	W_PRODUCT_D.ROW_WID PRODUCT_WID,
	COMPANY_SEGMENT.SCD1_WID GL_COMPANY_WID,
	(SELECT SCD1_WID FROM W_GL_SEGMENT_D WHERE X_SEGMENT_LOV_NAME='HOT Location' AND SEGMENT_VAL_CODE='000') GL_LOCATION_WID,
	PL_SEGMENT.SCD1_WID GL_PRODUCT_LINE_WID,
	C8_DEMAND_FLAG DEMAND_FLAG,
	C9_WEEKLY_FLAG WEEKLY_FLAG,
	C10_DAILY_CUTOFF_BUCKET DAILY_CUTOFF_BUCKET 
from	BI11G_DW.W_PRODUCT_D   W_PRODUCT_D, BI11G_DW.W_INT_ORG_D   W_INT_ORG_D, BI11G_DW.W_INVENTORY_PRODUCT_D   W_INVENTORY_PRODUCT_D, BI11G_DW.W_CUSTOMER_ACCOUNT_D   W_CUSTOMER_ACCOUNT_D, BI11G_DW.W_PARTY_D   W_PARTY_D, BI11G_DW.W_BUSN_LOCATION_D   W_BUSN_LOCATION_D, BI11G_DW.W_EXCH_RATE_G   W_EXCH_RATE_G, BI11G_DW.W_MCAL_DAY_D   W_MCAL_DAY_D, BI11G_DW.WC_MTL_SYSTEM_ITEMS_D   WC_MTL_SYSTEM_ITEMS_D, BI11G_DW.W_GL_SEGMENT_D   COMPANY_SEGMENT, BI11G_DW.W_GL_SEGMENT_D   PL_SEGMENT, BI11G_DW.C$_4980245864_1_0
where		(1=1)	
 And (WC_MTL_SYSTEM_ITEMS_D.SALES_ACCOUNT_HOT_COMPANY=COMPANY_SEGMENT.SEGMENT_VAL_CODE (+))
AND (WC_MTL_SYSTEM_ITEMS_D.SALES_ACCOUNT_PRODUCT_LINE=PL_SEGMENT.SEGMENT_VAL_CODE (+))
AND (W_PARTY_D.INTEGRATION_ID (+)=W_CUSTOMER_ACCOUNT_D.PARTY_ID)
AND (W_CUSTOMER_ACCOUNT_D.INTEGRATION_ID (+)=TO_CHAR(C11_CUSTOMER_ID))
AND ((TO_CHAR(C13_INVENTORY_ITEM_ID)||'~'||TO_CHAR(C12_ORGANIZATION_ID))=W_INVENTORY_PRODUCT_D.INTEGRATION_ID (+))
AND (('PLANT'||'~'||TO_CHAR(C12_ORGANIZATION_ID))=W_BUSN_LOCATION_D.INTEGRATION_ID (+))
AND (TO_CHAR(C13_INVENTORY_ITEM_ID)=W_PRODUCT_D.INTEGRATION_ID (+))
AND (C13_INVENTORY_ITEM_ID=WC_MTL_SYSTEM_ITEMS_D.INVENTORY_ITEM_ID (+) AND C12_ORGANIZATION_ID=WC_MTL_SYSTEM_ITEMS_D.ORGANIZATION_ID (+))
AND (W_EXCH_RATE_G.W_FROM_CURCY_CODE (+) = W_INT_ORG_D.W_CURR_CODE)
AND (W_INT_ORG_D.INTEGRATION_ID (+)=TO_CHAR(C12_ORGANIZATION_ID))
AND (C5_DUE_DATE=W_MCAL_DAY_D.MCAL_DAY_DT (+))
And (COMPANY_SEGMENT.X_SEGMENT_LOV_NAME (+)='HOT Company')
 And (PL_SEGMENT.X_SEGMENT_LOV_NAME (+)='HOT Product Line NEW')
 And (W_CUSTOMER_ACCOUNT_D.ACTIVE_FLG (+)='Y' AND W_CUSTOMER_ACCOUNT_D.ACCOUNT_CLASS_CODE (+) NOT IN ('FREIGHT CARRIER','SALESMAN','CONSUMER'))
 And (W_PRODUCT_D.CURRENT_FLG (+) ='Y')
 And (W_INT_ORG_D.INV_ORG_FLG (+)='Y')
 And (W_EXCH_RATE_G.EXCH_DT (+) > TRUNC(SYSDATE -7, 'MM')
AND W_EXCH_RATE_G.RATE_TYPE (+)='Corporate' 
AND W_EXCH_RATE_G.START_DT (+) <= SYSDATE 
AND W_EXCH_RATE_G.END_DT (+) >= SYSDATE 
AND W_EXCH_RATE_G.W_TO_CURCY_CODE (+) ='USD')
 And (W_BUSN_LOCATION_D.W_BUSN_LOC_TYPE_CODE (+)='PLANT')
 And (W_MCAL_DAY_D.MCAL_CAL_NAME (+)='5-4-4')
 And (W_INVENTORY_PRODUCT_D.CURRENT_FLG (+)='Y')




)    ODI_GET_FROM

/***********************************************************************************************************************************************************/
