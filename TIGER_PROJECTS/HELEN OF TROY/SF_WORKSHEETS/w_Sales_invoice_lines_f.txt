
--AUDIT LOGS
-- unique test


select count(*) from dev_discover.MASTER_DATA.stg_oracle__mtl_system_items where inventory_item_id = '77498'
select * from dev_discover.MASTER_DATA.stg_oracle__mtl_parameters where organization_id = '666'
select count(*) from "DEV_EDW"."EDW_OMNI"."W_SALES_DEMAND_F" 


 (SELECT distinct sr_organization_id
          FROM oracle_scp.msd_dp_scn_entries_denorm
          WHERE start_time >=(current_date()-365)
          AND BUCKET_TYPE   =2
          )

select
    integration_id 

from dev_edw.edw_omni.w_inventory_location_d
where integration_id is not null
group by integration_id
having count(*) > 1


SELECT INTEGRATION_ID FROM  "DEV_EDW"."EDW_OMNI"."W_INVENTORY_LOCATION_D" WHERE INTEGRATION_ID IS NULL
SELECT COUNT(*) FROM "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"
left outer join  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"
on "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL".customer_trx_id
                                = "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL".customer_trx_id
             
left outer join "ORACLE_FINANCIALS"."RA_CUST_TRX_TYPES_ALL"
on "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL".org_id = "ORACLE_FINANCIALS"."RA_CUST_TRX_TYPES_ALL".org_id
                            and "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL".cust_trx_type_id
                            = "ORACLE_FINANCIALS"."RA_CUST_TRX_TYPES_ALL".cust_trx_type_id
                            
left outer join  "ORACLE_FINANCIALS"."RA_SALESREPS_ALL"
 on "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL".primary_salesrep_id =  "ORACLE_FINANCIALS"."RA_SALESREPS_ALL".salesrep_id
 and "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL".org_id = "ORACLE_FINANCIALS"."RA_SALESREPS_ALL".org_id
 
 left outer join "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" RA_CUSTOMER_TRX_LINES_ALL1
                    on "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" .link_to_cust_trx_line_id
                    = RA_CUSTOMER_TRX_LINES_ALL1 .customer_trx_line_id
                    
 inner join "ORACLE_MASTER_DATA"."GL_LEDGERS" on "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL".set_of_books_id = "ORACLE_MASTER_DATA"."GL_LEDGERS".ledger_id

where
            (1 = 1)
           /*
            and (
                (
                    "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"._batch_update_date >= "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"._batch_update_date
                    and "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"._batch_update_date <=  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"._batch_update_date
                )
                or (
                    "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"._batch_update_date >=  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"._batch_update_date
                    and "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"._batch_update_date <=  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"._batch_update_date
                )
            )
            */
            and ("ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL".complete_flag = 'Y')
            and (
               "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL".interface_line_context
                in ('ORDER ENTRY', 'INTERCOMPANY', 'CRS')
                or RA_CUSTOMER_TRX_LINES_ALL1.interface_line_context
                in ('ORDER ENTRY', 'INTERCOMPANY', 'CRS')
            )
    
select * from "DEV_EDW"."BI11G_DW"."WC_DM_FORECAST_F"

desc table "DEV_EDW"."BI11G_DW"."WC_DM_FORECAST_F"

SELECT * FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"  limit 10
select conversion_date from "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" 
DROP TABLE   "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" 
SELECT UOM_CODE FROM "DEV_DISCOVER"."FINANCIALS"."STG_ORACLE__RA_CUSTOMER_TRX_LINES_ALL"
SELECT DISTINCT(CUSTOMER_TRX_LINE_ID) FROM  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" 
SELECT CUSTOMER_TRX_LINE_ID,COUNT(*) FROM  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" GROUP BY  CUSTOMER_TRX_LINE_ID 
HAVING  COUNT(*) > 1
SELECT COUNT(*) FROM "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"
SELECT COUNT(CUSTOMER_TRX_LINE_ID) FROM  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" WHERE CUSTOMER_TRX_LINE_ID = 10121072


-- audit logs 
select * from "DEV_EDW"."EDW_METADATA"."EL_AUDIT_BALANCE_LOG" where node_name = 'w_sales_invoice_line_f'


-- TRACH BATCH
SELECT * FROM "DEV_EDW"."EDW_METADATA"."EL_BATCH_REFRESH_TRACKER" WHERE TABLE_NAME =  'w_sales_invoice_line_f'
and  last_update_date = '2023-04-20 06:33:32.059'

update 
(--check for the date 20th in increemtnal)
  -- by updating refresh date tim  in tracker and use that batch _updaye 20th april in incremental test
  -- validate territoy id of sales_invoice with dimension terr_id


select UOM_CODE from "DEV_DISCOVER"."FINANCIALS"."STG_ORACLE__RA_CUSTOMER_TRX_LINES_ALL" WHERE CUSTOMER_TRX_LINE_ID
 = 5790175 
 SELECT DISTINCT(UOM_CODE) FROM "DEV_DISCOVER"."FINANCIALS"."STG_ORACLE__RA_CUSTOMER_TRX_LINES_ALL" WHERE CUSTOMER_TRX_LINE_ID
 = 5790175 
 select CUSTOMER_TRX_LINE_ID from "DEV_DISCOVER"."FINANCIALS"."STG_ORACLE__RA_CUSTOMER_TRX_LINES_ALL"  WHERE CUSTOMER_TRX_LINE_ID
 = 5790175 

AND ITEM_ID  IN (SELECT ITEM_ID FROM "DEV_ODS"."ORACLE_SCP"."SALES_DATA")
SELECT ITEM_ID,BUDGET FROM "DEV_ODS"."ORACLE_SCP"."SALES_DATA" WHERE ITEM_ID = 13954  AND SALES_DATE = '2021-02-01 00:00:00.000'
DESC TABLE "DEV_EDW"."EDW_OMNI"."W_DM_FORECAST_F"
--UPDATE INCREMENTAL TEST

SELECT _batch_insert_date,_batch_update_date,_source_id FROM "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" 
SELECT BILL_TO_CONTACT_ID FROM   "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL" WHERE CUSTOMER_TRX_ID = 5790175
UPDATE "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"   SET BILL_TO_CONTACT_ID
  =87 WHERE CUSTOMER_TRX_ID = 5790175
UPDATE "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"  SET _batch_update_date = CURRENT_TIMESTAMP() WHERE CUSTOMER_TRX_ID = 5790175
SELECT interface_line_attribute11  FROM  "DEV_DISCOVER"."FINANCIALS"."STG_ORACLE__SALES_INVOICES"
SELECT CUSTOMER_ACCOUNT_ID FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" WHERE INVOICE_HEADER_ID  =  5790175
SELECT interface_line_attribute12,integration_id  FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" WHERE INTEGRATION_ID LIKE '197591786~100'
DESC TABLE "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" 
SELECT INTEGRATION_ID,W_INSERT_DT,W_UPDATE_DT FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" 
SELECT interface_line_attribute12,_batch_update_date FROM  "DEV_DISCOVER"."FINANCIALS"."STG_ORACLE__SALES_INVOICE_LINES" WHERE CUSTOMER_TRX_LINE_ID = '5092781'


-- cross check with production with integration_ids
select INVENTORY_ORG_WID,OPERATING_UNIT_ORG_WID from "DEV_EDW"."BI11G_DW"."W_SALES_INVOICE_LINE_F" WHERE INVENTORY_ORG_WID NOT IN (271,264,55,265) limit 1000 
select INTEGRATION_ID,INVENTORY_ORG_WID,OPERATING_UNIT_ORG_WID from "DEV_EDW"."BI11G_DW"."W_SALES_INVOICE_LINE_F" WHERE INTEGRATION_ID = '159603606'

SELECT INTEGRATION_ID,W_INSERT_DT,W_UPDATE_DT,INVENTORY_ORG_ID,OPERATING_UNIT_ORG_ID FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" WHERE INTEGRATION_ID = '159603606~100' LIMIT 100
SELECT INTEGRATION_ID,W_INSERT_DT,W_UPDATE_DT,INVENTORY_ORG_ID,OPERATING_UNIT_ORG_ID FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"WHERE OPERATING_UNIT_ORG_ID = '112~100'  LIMIT 10
SELECT INTEGRATION_ID,W_INSERT_DT,W_UPDATE_DT,INVENTORY_ORG_ID,OPERATING_UNIT_ORG_ID FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"WHERE INVENTORY_ORG_ID = '209~100'  LIMIT 10

select COUNT(*) from "DEV_EDW"."BI11G_DW"."W_SALES_INVOICE_LINE_F"





DELETE FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"WHERE  INTEGRATION_ID ='298601412~100'
select  INTEGRATION_ID,interface_line_attribute12,W_UPDATE_DT from "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" WHERE  INTEGRATION_ID ='298601412~100'
UPDATE "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"  SET _batch_update_date = CURRENT_TIMESTAMP() WHERE CUSTOMER_TRX_LINE_ID
 ='298601412'
 UPDATE "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"  SET interface_line_attribute12  = '1'  WHERE CUSTOMER_TRX_LINE_ID = '298601412'
 select CUSTOMER_TRX_LINE_ID,interface_line_attribute12,_batch_update_date,interface_line_context  from "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" where 
 interface_line_context is not null
  select CUSTOMER_TRX_LINE_ID,interface_line_attribute12,_batch_update_date,interface_line_context  from "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" where 
CUSTOMER_TRX_LINE_ID = '298601412'

 SELECT _SOURCE_ID FROM "DEV_DISCOVER"."FINANCIALS"."STG_ORACLE__SALES_INVOICE_LINES" WHERE   CUSTOMER_TRX_LINE_ID = 158119509
SELECT count(*) FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" WHERE INTEGRATION_ID IS not NULL
SELECT * FROM "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" 
SELECT integration_id,interface_line_attribute12,W_UPDATE_DT,W_INSERT_DT FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"  limit 10
SELECT COUNT(*) FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" 


 UPDATE "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"   SET BILL_TO_CONTACT_ID
  = 7 WHERE CUSTOMER_TRX_ID = 5790175
select * from "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" where CUSTOMER_TRX_LINE_ID = 158119509
DROP TABLE  "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"
SELECT COUNT(*) FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"


 
SELECT count(*) FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"
WHERE  INTEGRATION_ID = 5790175
select ITEM_ID,BUDGET from "DEV_ODS"."ORACLE_SCP"."SALES_DATA" WHERE ITEM_ID = 13954  AND SALES_DATE = '2021-02-01 00:00:00.000'

UPDATE ORACLE_MASTER_DATA.HZ_CUST_SITE_USES_ALL    SET _batch_update_date = CURRENT_TIMESTAMP() WHERE SITE_USE_ID = 7943537



-- MISSING ROW

SELECT INTEGRATION_ID FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"  WHERE INTEGRATION_ID NOT IN 
(select CUSTOMER_TRX_LINE_ID from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" )

-- SAMPLE 10 ID'S TAKEN FROM TARGET
SELECT INTEGRATION_ID FROM "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" LIMIT 10
-- CHECK ONE OF THE ID PRESENT IN SOURCE TABLE
select * from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" WHERE  CUSTOMER_TRX_LINE_ID = 110387064
-- CHECK THAT PARTICULAR ID PRESENT IN TRX_ALL
select * from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" 
WHERE CUSTOMER_TRX_ID IN (select CUSTOMER_TRX_ID from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"  WHERE CUSTOMER_TRX_ID = 7575066)


-- NOT PRESENT

-- CHECK ONE OF THE ID PRESENT IN SOURCE TABLE
select * from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" WHERE  CUSTOMER_TRX_LINE_ID = 296055358
-- CHECK THAT PARTICULAR ID PRESENT IN TRX_ALL
select * from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"  
WHERE CUSTOMER_TRX_ID IN (select CUSTOMER_TRX_ID from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"  WHERE CUSTOMER_TRX_ID = 88035)

(select * from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"  WHERE CUSTOMER_TRX_ID = 22476757)
(select * from  "ORACLE_FINANCIALS"."RA_CUST_TRX_TYPES_ALL"  WHERE CUST_TRX_TYPE_ID = 296055358)
(select * from  "ORACLE_FINANCIALS"."RA_SALESREPS_ALL"  WHERE salesrep_id = 296055358)
SELECT COUNT(*) FROM "DEV_DISCOVER"."FINANCIALS"."STG_ORACLE__W_SALES_INVOICE_LINE_FS"
SELECT * FROM "ORACLE_MASTER_DATA"."GL_LEDGERS" WHERE ledger_id = 296055358


(select * from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"  WHERE CUSTOMER_TRX_LINE_ID = 129250651)
(select * from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"  WHERE CUSTOMER_TRX_ID = 129250651)
(select * from  "ORACLE_FINANCIALS"."RA_CUST_TRX_TYPES_ALL"  WHERE CUST_TRX_TYPE_ID = 129250651)
(select * from  "ORACLE_FINANCIALS"."RA_SALESREPS_ALL"  WHERE salesrep_id = 129250651)
SELECT * FROM "ORACLE_MASTER_DATA"."GL_LEDGERS" WHERE ledger_id = 129250651

select count(*) from "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F"
select  * from "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL" where customer_trx_line_id = 1815577
--289672552-288069272
SELECT customer_trx_line_id FROM "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"  WHERE CUSTOMER_TRX_LINE_ID NOT IN 
(select INVOICE_HEADER_ID from  "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" ) 

SELECT customer_trx_line_id FROM "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"  WHERE CUSTOMER_TRX_LINE_ID IN 
(select INTEGRATION_ID from  "DEV_EDW"."EDW_OMNI"."W_SALES_INVOICE_LINE_F" ) 

select * from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_LINES_ALL"  
WHERE CUSTOMER_TRX_ID IN (select CUSTOMER_TRX_ID from  "ORACLE_FINANCIALS"."RA_CUSTOMER_TRX_ALL"  WHERE CUSTOMER_TRX_ID = 92578)